{# app/templates/ui/steps/_05_temps_travail.html.j2 #}

<div class="step card flow-16" data-step="5" aria-hidden="true">
  <h3>05. DurÃ©e du travail</h3>

  <!-- Slots â€œpÃ©dagogieâ€ injectÃ©s par lâ€™API (explain[]) -->
  <div id="slot_step5_block"  class="callout" data-slot="step5.block"  style="display:none"></div>

  <!-- Hintbar discrÃ¨te (rappel lÃ©gal/contrat) -->
  <div class="hintbar" role="note" aria-live="polite">
    ğŸ’¡ L'entreprise devra s'assurer que le temps de travail rÃ©el du salariÃ© ne dÃ©passe pas ce qui est prÃ©vu dans son contrat. Ã€ dÃ©faut, le salariÃ© peut rÃ©clamer le paiement d'heures supplÃ©mentaires.
  </div>

  <!-- RÃ©gime -->
  <div class="fieldset flow-12">
    <div class="label-inline">
      <span><strong>Mode de durÃ©e du travail choisi pour la salariÃ©</strong></span>
    </div>

    <div class="vlist" style="gap:10px">
      <div class="radio">
        <input type="radio" name="work_time_regime" id="reg_full" value="temps_complet" data-required="true">
        <label class="label" for="reg_full">
          Temps complet
          <span class="help" title="Le contrat de travail Ã  temps complet dÃ©signe le contrat pour lequel le salariÃ© travaille un nombre dâ€™heures correspondant Ã  la durÃ©e lÃ©gale du travail en vigueur, ou le cas Ã©chÃ©ant, Ã  la durÃ©e conventionnelle de travail applicable dans lâ€™entreprise, dÃ©terminÃ©e par une convention ou un accord collectif.">i</span>
        </label>
        <span></span>
      </div>

      <div class="radio">
        <input type="radio" name="work_time_regime" id="reg_part" value="temps_partiel">
        <label class="label" for="reg_part">
          Temps partiel
          <span class="help" title="DurÃ©e contractuelle &lt; 35h/semaine. Minimum lÃ©gal usuel : 24h sauf dÃ©rogations prÃ©vues par la loi/CCN.">i</span>
        </label>
        <span></span>
      </div>
    </div>

    <div id="regime_hint" class="note"></div>
  </div>

    <!-- Bandeau de conformitÃ© par rÃ©gime (supprimÃ© au profit des hints dynamiques) -->

  <!-- Rappels lÃ©gaux (journÃ©e / repos) -->
  <details class="callout callout-info zoom-card mt-12">
    <summary>Rappels lÃ©gaux (journÃ©e et repos)</summary>
    <div class="body">
      <ul>
        <li>DurÃ©e quotidienne maximale usuelle&nbsp;: <strong>10&nbsp;heures</strong> (dÃ©rogations possibles sous conditions).</li>
        <li>Repos quotidien obligatoire&nbsp;: <strong>11&nbsp;heures consÃ©cutives</strong>.</li>
        <li>Repos hebdomadaire&nbsp;: <strong>24&nbsp;heures</strong> + repos quotidien (soit <strong>35&nbsp;heures</strong> consÃ©cutives).</li>
        <li>Hebdomadaire&nbsp;: plafond absolu <strong>48&nbsp;heures</strong> et moyenne <strong>44&nbsp;heures</strong> sur 12&nbsp;semaines.</li>
        <li>En cas dâ€™amplitudes et de coupures, respecter les plafonds et prÃ©voir les contreparties le cas Ã©chÃ©ant.</li>
      </ul>
    </div>
  </details>


  <hr class="divider">

  <!-- ModalitÃ©s (affichÃ© uniquement si temps complet) -->
  <div id="wt_modalities" class="fieldset flow-12" style="display:none">
    <div class="label-inline">
      <span><strong>DurÃ©e de travail envisagÃ©e</strong></span>
    </div>

    <div class="vlist" style="gap:10px">
      <div class="radio">
        <input type="radio" name="work_time_mode" id="wt_35" value="standard_35h" data-required="true">
        <label class="label" for="wt_35">35 heures par semaine</label>
        <span></span>
      </div>

      <div class="radio">
        <input type="radio" name="work_time_mode" id="wt_fh_pay" value="forfait_hours">
        <label class="label" for="wt_fh_pay">
          Forfait heures avec paiement des heures supplÃ©mentaires
          <span class="help" title="Les heures auâ€‘delÃ  de la valeur hebdomadaire de rÃ©fÃ©rence sont payÃ©es avec les majorations applicables.">i</span>
        </label>
        <span></span>
      </div>

      <div class="radio">
        <input type="radio" name="work_time_mode" id="wt_fh_repos" value="forfait_hours">
        <label class="label" for="wt_fh_repos">
          Forfait heures avec compensation en repos Ã©quivalent
          <span class="help" title="Les heures supplÃ©mentaires sont compensÃ©es par un repos dâ€™Ã©gale durÃ©e, le cas Ã©chÃ©ant majorÃ©.">i</span>
        </label>
        <span></span>
      </div>

      <div class="radio">
        <input type="radio" name="work_time_mode" id="wt_fd" value="forfait_days">
        <label class="label" for="wt_fd">
          Forfait jours
          <span class="help" title="Plafond annuel en jours (ex. 218). RÃ©servÃ© Ã  certains profils et/ou ouvert par accord.">i</span>
        </label>
        <span></span>
      </div>

      <div class="radio">
        <input type="radio" name="work_time_mode" id="wt_m2" value="modalite_2">
        <label class="label" for="wt_m2">
          Forfait heures sur la semaine avec plafond annuel jours (modalitÃ©Â 2 â€“ RÃ©alisation de mission)
          <span class="help" title="SpÃ©cifique SyntecÂ : plafond en jours + plafond hebdomadaire (ex. 38h30).">i</span>
        </label>
        <span></span>
      </div>
    </div>
  </div>

  <!-- Sousâ€‘blocs par modalitÃ© -->
  <div id="blk_standard" class="fieldset flow-12" style="display:none">
    <div class="row">
      <div>
        <label>
          Heures / <span id="std_hours_unit">semaine</span>
          <span class="help" title="35h fixes Ã  temps complet. Ã€ temps partiel : champ Ã©ditable avec bornes lÃ©gales.">i</span>
        </label>
        <input type="number" step="0.1" min="1" max="80" name="weekly_hours" id="weekly_hours_std" value="35" readonly>
        <input type="hidden" id="weekly_hours_hidden" name="weekly_hours_hidden">
        <small id="std_err" class="error-msg" aria-live="polite"></small>
      </div>
    </div>
    <div id="std_card" class="callout mt-12" data-slot="step5.block.std" style="display:none"></div>
    <div id="slot_step5_header" class="callout" data-slot="step5.header" style="display:none"></div>
  </div>

  <div id="blk_forfait_hours" class="fieldset flow-12" style="display:none">
    <div class="row">
      <div>
        <label>
          Quelle est la durÃ©e hebdomadaire de travail ?
          <span class="help" title="Valeur de rÃ©fÃ©rence de ton forfait heures (ex. 37,5h, 39hâ€¦).">i</span>
        </label>
        <input type="number" step="0.1" min="35" name="weekly_hours" id="weekly_hours_fh" placeholder="Ex. 37.5">
        <small id="fh_err" class="error-msg" aria-live="polite"></small>
      </div>
    </div>
    <div id="fh_card" class="callout mt-12" data-slot="step5.block.fh" style="display:none"></div>
  </div>

  <div id="blk_forfait_days" class="fieldset flow-12" style="display:none">
    <div id="fd_guard" class="callout mt-12" data-slot="step5.block.fd" style="display:none"></div>

    <div class="row">
      <div>
        <label>
          Nombre de jours (an)
          <span class="help" title="Plafond annuel en jours. Ã€ dÃ©faut, 218 est la pratique la plus rÃ©pandue sous rÃ©serve des garanties dâ€™autonomie.">i</span>
        </label>
        <input type="number" min="1" max="230" name="forfait_days_per_year" id="forfait_days_per_year" placeholder="218 par dÃ©faut">
        <small id="fd_err" class="error-msg" aria-live="polite"></small>
      </div>
    </div>

    <div id="fd_info" class="callout mt-12" data-slot="step5.block.fd.info" style="display:none"></div>
  </div>

  <div id="blk_modalite_2" class="fieldset flow-12" style="display:none">
    <div class="row">
      <div>
        <label>
          Heures / semaine (max 38,5h)
          <span class="help" title="SyntecÂ : plafond usuel 38h30 (selon CCN/accord).">i</span>
        </label>
        <input type="number" step="0.1" min="35" max="38.5" id="weekly_hours_m2" name="weekly_hours" placeholder="jusquâ€™Ã  38.5">
        <small id="m2_err" class="error-msg" aria-live="polite"></small>
      </div>
      <div>
        <label>
          Plafond annuel en jours (si applicable)
          <span class="help" title="Sous Syntec (modalitÃ© 2), un plafond annuel en jours peut exister par accord. Vous pouvez prÃ©voir contractuellement un plafond infÃ©rieur au maximum conventionnel, sous rÃ©serve de respecter les garanties de la CCN et du Code du travail.">i</span>
        </label>
        <input type="number" min="1" max="230" id="m2_days_cap" name="m2_days_cap" placeholder="selon CCN/accord">
      </div>
    </div>
    <div id="m2_card" class="callout mt-12" data-slot="step5.block.m2" style="display:none"></div>
  </div>

  <hr class="divider">

  <!-- TEMPS PARTIEL (affichÃ© quand "Temps partiel" est cochÃ©) -->
  <div id="blk_part_time" class="fieldset flow-12" style="display:none">
    <div id="pt_header" class="callout mb-16" data-slot="step5.part_time.header" style="display:none"></div>

    <h4 class="mb-4">
      Organisation du temps partiel
      <span class="help" title="Choisissez un mode d'organisation horaire du temps de travail du salariÃ©.">i</span>
    </h4>

    <div class="vlist" style="gap:10px">
      <div class="radio">
        <input type="radio" name="pt_org" id="pt_org_fixed" value="fixed">
        <label class="label" for="pt_org_fixed">
          RÃ©partition hebdomadaire <strong>dÃ©terminÃ©e</strong> par jour
        </label>
        <span class="help" title="Vous dÃ©finissez prÃ©cisÃ©ment les jours travaillÃ©s (ex. Lundi 6h, Mardi 6hâ€¦). Le total hebdomadaire doit rester conforme Ã  la loi/CCN.">i</span>
      </div>
      <div class="radio">
        <input type="radio" name="pt_org" id="pt_org_month" value="monthly">
        <label class="label" for="pt_org_month">
          RÃ©partition <strong>mensuelle</strong> par semaine
        </label>
        <span class="help" title="Vous dÃ©finissez, pour chaque semaine (1 Ã  4), un volume d'heures. La moyenne hebdomadaire alimentera Â«â€¯Heures/semaineâ€¯Â».">i</span>
      </div>
    </div>

    <!-- A. RÃ©partition dÃ©terminÃ©e -->
    <div id="pt_fixed_box" class="flow-12" style="display:none">
      <p class="subtle-label">PrÃ©ciser les jours travaillÃ©s et la durÃ©e journaliÃ¨re.</p>

      <div class="pt-grid">
        {% set days = [
          ('mon','Lundi'),('tue','Mardi'),('wed','Mercredi'),
          ('thu','Jeudi'),('fri','Vendredi'),('sat','Samedi'),('sun','Dimanche')
        ] %}
        {% for key,label in days %}
        <div class="pt-row">
          <label class="pt-daylabel" for="pt_{{key}}_on">{{ label }}</label>
          <input type="checkbox" id="pt_{{key}}_on" class="pt-check">
          <input type="number" step="0.1" min="0" max="12" id="pt_{{key}}_hours" class="pt-hours" placeholder="heures" disabled>
        </div>
        {% endfor %}
      </div>

      <div class="pt-total">
        <small>Total hebdomadaire calculÃ© : <strong id="pt_total_hours">0.0</strong>â€¯h</small>
        <small class="muted">â†’ ce total alimente Â«â€¯Heures/semaineâ€¯Â» ciâ€‘dessus.</small>
      </div>

      <!-- Slot optionnel si lâ€™API veut complÃ©ter -->
      <div id="pt_fixed_card" class="callout" data-slot="step5.part_time.fixed" style="display:none"></div>

      

    </div>

    <!-- B. RÃ©partition mensuelle par semaine -->
    <div id="pt_monthly_box" class="flow-12" style="display:none">
      <p class="subtle-label">PrÃ©ciser, pour chaque semaine du mois, le nombre dâ€™heures travaillÃ©es.</p>

      <div class="pt-grid">
        {% for i in [1,2,3,4] %}
        <div class="pt-row">
          <label class="pt-daylabel" for="pt_w{{i}}_on">Semaine {{ i }}</label>
          <input type="checkbox" id="pt_w{{i}}_on" class="pt-check">
          <input type="number" step="0.1" min="0" max="60" id="pt_w{{i}}_hours" class="pt-hours" placeholder="heures" disabled>
        </div>
        {% endfor %}
      </div>

      <div class="pt-total">
        <small>Total mensuel calculÃ© : <strong id="pt_total_hours_month">0.0</strong>â€¯h</small>
        <small class="muted">â†’ la <b>moyenne hebdomadaire</b> (total/4) alimente Â«â€¯Heures/semaineâ€¯Â» ciâ€‘dessus.</small>
      </div>
    </div>

    <!-- Rappel commun (hebdomadaire par jour OU mensuelle par semaine) -->
    <details class="callout callout-info zoom-card mt-24">
      <summary>Rappel sur lâ€™organisation dÃ©terminÃ©e par jour ou semaine</summary>
      <div class="body">
        <p><strong>RÃ©partition hebdomadaire dÃ©terminÃ©e par jour</strong>Â : prÃ©ciser les <em>jours travaillÃ©s</em> et la <em>durÃ©e quotidienne</em>. Le total hebdomadaire calculÃ© alimente Â«â€¯Heures/semaineâ€¯Â». Les modifications ponctuelles respectent un <em>dÃ©lai de prÃ©venance</em> raisonnable et les rÃ¨gles applicables (repos quotidien 11â€¯h, repos hebdomadaire, durÃ©es maximales).</p>
        <p><strong>RÃ©partition mensuelle par semaine</strong>Â : renseigner les heures pour les semaines <em>1 Ã  4</em>. La <em>moyenne hebdomadaire</em> (total/4) alimente Â«â€¯Heures/semaineâ€¯Â». Les planchers/plafonds de temps partiel sâ€™apprÃ©cient sur cette moyenne. Communiquer le planning Ã  lâ€™avance.</p>
        <p>En temps partiel, les <em>heures complÃ©mentaires</em> et le cas Ã©chÃ©ant les <em>avenants de complÃ©ments dâ€™heures</em> obÃ©issent aux limites prÃ©vues par la loi/CCN.</p>
      </div>
    </details>


    <!-- C. RÃ¨gles communes (coupures journaliÃ¨res / cadre / slots API) -->
    <div id="pt_common_box" class="flow-12" style="display:none">
      <p class="subtle-label mt-24">
        Coupures journaliÃ¨res : fixer un plafond (nombre/durÃ©e) et les contreparties Ã©ventuelles prÃ©vues par lâ€™accord.
      </p>

      <div class="grid2">
        <div>
          <label>Cadre choisi</label>
          <select id="pt_flex_frame">
            <option value="code">Ã€ dÃ©faut dâ€™accord (cadre lÃ©gal par dÃ©faut)</option>
            <option value="ccn_ae">Selon convention/accord (branche ou entreprise)</option>
          </select>
        </div>
        <div>
          <label>Repos quotidien (rappel)</label>
          <input id="pt_flex_rest" value="11â€¯heures consÃ©cutives (rappel lÃ©gal)" readonly>
        </div>
      </div>

      <div class="grid3">
        <div>
          <label>Nb max de coupures / jour</label>
          <input type="number" id="pt_breaks_max" min="0" max="5" placeholder="1">
        </div>
        <div>
          <label>DurÃ©e max coupure (heures)</label>
          <input type="number" step="0.1" id="pt_break_max_hours" min="0" max="6" placeholder="2">
        </div>
        <div>
          <label>Contreparties (si prÃ©vues)</label>
          <input id="pt_break_counterparties" placeholder="ex. prime, reposâ€¦">
        </div>
      </div>

      <!-- Slots optionnels API -->
      <div id="pt_flex_card" class="callout" data-slot="step5.part_time.flex" style="display:none"></div>
      <div id="pt_coupures_card" class="callout" data-slot="step5.part_time.coupures" style="display:none"></div>

      

    </div>

    <hr class="divider">

    <!-- C. Modification de la rÃ©partition -->
    <div class="flow-12">
      <h4 class="mb-4">
        Modification de la rÃ©partition
        <span class="help" title="La rÃ©partition peut Ãªtre modifiÃ©e pour des motifs objectifs (ex. variation dâ€™activitÃ©, rÃ©organisation des horaires dâ€™ouverture, remplacement dâ€™un collÃ¨gue), dans le respect du dÃ©lai de prÃ©venance et des garanties prÃ©vues par la loi/CCN.">i</span>
      </h4>

      <p class="subtle-label">Lister les cas permettant le changement et indiquer le dÃ©lai de prÃ©venance.</p>

      <div class="grid2">
        <div>
          <label>Motifs possibles (liste)</label>
          <textarea id="pt_modif_reasons" rows="3" placeholder="ex. renforcement de lâ€™Ã©quipe, variation de la clientÃ¨le, changement dâ€™horaires dâ€™ouvertureâ€¦"></textarea>
        </div>
        <div>
          <label>DÃ©lai de prÃ©venance</label>
          <div class="grid2">
            <input type="number" id="pt_modif_notice_days" min="0" placeholder="7">
            <select id="pt_modif_notice_unit">
              <option value="jours">jours</option>
              <option value="jours_ouvres">jours ouvrÃ©s</option>
            </select>
          </div>
        </div>
      </div>

      <div id="pt_modif_card" class="callout" data-slot="step5.part_time.modif" style="display:none"></div>
    </div>

    <hr class="divider">

    <!-- D. PrioritÃ© dâ€™affectation -->
    <div class="flow-12">
      <h4 class="mb-4">
        PrioritÃ© dâ€™affectation
        <span class="help" title="Le salariÃ© Ã  temps partiel bÃ©nÃ©ficie dâ€™une prioritÃ© pour occuper un emploi correspondant Ã  sa catÃ©gorie professionnelle ou Ã©quivalent permettant dâ€™augmenter sa durÃ©e de travail, sous rÃ©serve des postes disponibles et des conditions prÃ©vues par la loi/CCN.">i</span>
      </h4>

      <label>DÃ©lai maximal de rÃ©ponse aux candidatures internes</label>
      <input type="number" id="pt_priority_reply_days" min="1" placeholder="15">
      <small class="muted">UtilisÃ© dans la clause automatique Â«â€¯PrioritÃ© dâ€™affectationâ€¯Â».</small>
    </div>

    <!-- JSON sÃ©rialisÃ© pour le backend -->
    <input type="hidden" id="part_time_payload" name="part_time_payload">
  </div>

  <hr class="divider">

  <!-- Zoom pÃ©dagogique par catÃ©gorie -->
  <details id="zoom_by_cat" class="callout callout-info zoom-card" style="display:block" mt-24>
    <summary id="zoom_cat_summary">Zoom sur la durÃ©e de travail</summary>
    <div class="body" id="zoom_cat_body"></div>
  </details>

  <div class="actions mt-16">
    <button class="btn" data-prev>PrÃ©cÃ©dent</button>
    <button class="btn-primary" data-next>Suivant</button>
  </div>
</div>
