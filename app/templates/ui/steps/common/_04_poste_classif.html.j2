{# app/templates/ui/steps/_04_poste_classif.html.j2 #}
<div class="step card" data-step="4" aria-hidden="true">
  <h3>04. Poste &amp; classification</h3>

  <hr class="divider">

  <!-- Poste -->
  <h4 style="margin:0 0 6px">Poste
    <span class="help" title="Le poste de travail correspond à la relation entre un salarié et un établissement pendant une période donnée.">i</span>
  </h4>
  
  <div class="grid2">
    <div>
      <label>Intitulé du poste du salarié
        <span class="help" title="Précisez le poste exact. Il sera repris sur le bulletin de paie, l’organigramme, etc.">i</span>
      </label>
      <input name="job_title" data-required="true" placeholder="Ex. Développeur back‑end, Chef de projet…">
    </div>
    <div>
      <label>Date de début
        <span class="help" title="Précisez la date exacte de prise de fonction. Elle détermine le début de l'ancienneté du salarié ainsi que le début et la fin de la période d'essai.">i</span>
      </label>
      <input type="date" name="contract_start" id="contract_start" data-required="true">
    </div>
  </div>

  <hr class="divider">

  <!-- Missions : wording + choix d’emplacement -->
  <h4 style="margin:0 0 6px">Missions</h4>
  <p class="subtle-label" style="margin-top:10px">
    Les missions principales du salarié sont mentionnées
    <span class="help" title="La mission peut figurer dans le contrat ou dans une fiche de poste annexée.">i</span>
  </p>
  <div class="grid2">
    <label class="inline">
      <input type="checkbox" id="mission_in_contract" name="mission_in_contract" value="on"> <span>Dans le contrat de travail</span>
    </label>
    <label class="inline">
      <input type="checkbox" id="mission_in_annex" name="mission_in_annex" value="on"> <span>Dans une fiche de poste en annexe du contrat</span>
    </label>
  </div>
  <div id="mission_contract_fields" class="callout-muted" style="display:none">
    <div><label>Mission principale</label><textarea name="main_mission" rows="3"></textarea></div>
    <div><label>Activités annexes (optionnel)</label><textarea name="annex_activities" rows="2"></textarea></div>
  </div>
  <div id="mission_annex_banner" class="callout" style="display:none;margin-top:8px">
    Le contrat ne contiendra pas de descriptif du poste. Une fiche de poste devra être annexée.
  </div>

  <hr class="divider">

  <!-- Lieu de travail -->
  <div class="fieldset" style="margin-top:8px">
    <h4 style="margin:0 0 6px">Lieu de travail
       <span class="help" title="Le lieu de travail s'entend du lieu où le travail habituel s'accomplit.">i</span>
    </h4>
    <div class="grid2">
      <div>
        <label>Lieu principal</label>
        <input name="workplace_base" data-required="true" placeholder="Adresse / site / ville">
      </div>
      <div>
        <label>Secteur géographique (optionnel)</label>
        <input name="work_area" placeholder="Ex. Île‑de‑France, Grand Ouest…">
      </div>
    </div>
  </div>

  <hr class="divider">

  <!-- Classification CCN : deux colonnes, listes verticales -->
  <h4 style="margin:0 0 6px">Classification
     <span class="help" title="La classification professionnelle d'un salarié revient à définir le niveau du salarié dans l'entreprise en fonction de ses compétences et de son ancienneté dans l'emploi proposé, ainsi qu'en fonction des tâches demandées. ">i</span>
  </h4>
  <div style="margin-top:10px">
    <div class="grid2 align-top">
      <div>
        <label class="subtle-label">Catégorie (selon la CCN sélectionnée)</label>
        <div id="classif_cat_container" class="vlist" role="radiogroup" aria-label="Catégorie CCN"></div>
      </div>
      <div>
        <label class="subtle-label">Niveau / coefficient</label>
        <div id="classif_pos_container" class="vlist" role="radiogroup" aria-label="Niveau / coefficient"></div>
      </div>
    </div>

    <!-- Fallback générique si pas de schéma CCN -->
    <div id="classif_fallback" style="display:none;margin-top:12px">
      <div class="grid2">
        <div>
          <label>Catégorie (générique)</label>
          <select id="fallback_cat">
            <option value="cadre">Cadre</option>
            <option value="non-cadre" selected>Non‑cadre</option>
          </select>
        </div>
        <div>
          <label>Niveau / coefficient (texte libre)</label>
          <input id="fallback_level" placeholder="Ex. Coef 240">
        </div>
      </div>
      <small class="muted">Aucune classification CCN disponible : saisie libre.</small>
    </div>
  </div>

  <!-- Requis backend -->
  <input type="hidden" name="categorie" id="categorie" value="non-cadre">
  <input type="hidden" name="classification_level" id="classification_level">

  <hr class="divider">

  <!-- Ancienneté (déplacée depuis l’étape 8 pour alimenter tous les thèmes) -->
  <h4 style="margin:0 0 6px">Ancienneté
    <span class="help" title="0 si embauche initiale. Renseignez uniquement s’il y a reprise d’ancienneté (ou pour simuler des règles dépendant d’un palier).">i</span>
  </h4>
  <div class="grid2" style="margin-top:8px">
    <div>
      <label>Ancienneté — années</label>
      <input id="seniority_years" type="number" min="0" step="1" value="0">
    </div>
    <div>
      <label>Ancienneté — mois</label>
      <input id="seniority_months" type="number" min="0" max="11" step="1" value="0">
    </div>
  </div>

  <hr class="divider">

      {# ---- HINTS (classification) ---- #}
  <div id="step4_header_card" class="callout" data-slot="step4.header" style="display:none"></div>

  <div class="actions" style="margin-top:10px">
    <button class="btn" data-prev>Précédent</button>
    <button class="btn-primary" data-next>Suivant</button>
  </div>
</div>
