{% from 'components/macros.html.j2' import callout, error_msg %}

<div class="step card" data-step="{{ step_num|default('6') }}" aria-hidden="true">
  <h3>{{ "%02d"|format(step_num|default(6)) }}. R√©mun√©ration
    <span class="help" title="Pour pr√©voir une r√©mun√©ration variable (objectifs/commissions), ajoutez une clause d√©di√©e √† l‚Äô√©tape 9 (¬´¬†Clauses additionnelles¬†¬ª ‚Üí R√©mun√©ration variable).">i</span>
  </h3>

  <!-- Bandeau d‚Äôinfo (minima / plancher) aliment√© par l‚ÄôAPI -->
  <div id="salary_card" class="callout" data-slot="step6.footer" style="display:none;margin-top:10px"></div>

  {# Info CDD uniquement ‚Äî √©quivalence de r√©mun√©ration (L.1242‚Äë15) #}
  {% if doc_type == 'cdd' %}
  <div class="callout callout-info" style="margin-top:10px">
    <strong>R√©mun√©ration √©quivalente (CDD)</strong><br>
    L‚ÄôArticle L. 1242‚Äë15 du Code du travail impose que la r√©mun√©ration d‚Äôun salari√© en CDD soit au moins celle d‚Äôun salari√© en CDI ¬´ de qualification professionnelle √©quivalente et occupant les m√™mes fonctions ¬ª, ce qui correspond √† l‚Äôid√©e de ¬´ poste √©quivalent ¬ª.
    <br>
    <small>
      <a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006901209" target="_blank" rel="noopener">Consulter l‚Äôarticle L. 1242‚Äë15</a>
    </small>
  </div>
  {% endif %}


  <!-- Saisie principale -->
  <div class="grid2">
    <div>
      <label for="salary_gross_monthly">R√©mun√©ration brute mensuelle</label>
      <div class="input-with-suffix">
        <input id="salary_gross_monthly"
               name="salary_gross_monthly"
               type="number" step="0.01" inputmode="decimal"
               data-required="true" placeholder="Ex. 3200">
        <span class="suffix">‚Ç¨ bruts / mois</span>
      </div>
      <div id="salary_err" class="error-msg" aria-live="polite"></div>
    </div>

    <div>
      <label for="salary_gross_annual">
        R√©mun√©ration brute annuelle <small>(13·µâ inclus si coch√©)</small>
      </label>
      <div class="input-with-suffix">
        <input id="salary_gross_annual" type="text" readonly placeholder="‚Äî">
        <span class="suffix">‚Ç¨ bruts / an</span>
      </div>
    </div>
  </div>

    <div class="divider"></div>

  <!-- Accessoires -->
  <div class="fieldset" style="margin-top:20px">
    <label>√âl√©ments de r√©mun√©ration accessoires (optionnel)</label>
    <textarea name="remuneration_accessories" id="remuneration_accessories" rows="2"
              placeholder="Ex. prime d‚Äôobjectif, prime panier‚Ä¶"></textarea>
  </div>

  <div class="fieldset" style="margin-top:8px">
    <label>Politique de frais (optionnel)</label>
    <textarea name="expense_policy" id="expense_policy" rows="2"
              placeholder="Ex. bar√®me kilom√©trique, per diem, justificatifs requis‚Ä¶"></textarea>
  </div>

  <div class="hintbar" style="margin-top:10px">
    üí° Pour pr√©voir une r√©mun√©ration variable (objectifs/commissions), ajoutez une clause d√©di√©e √† l‚Äô√©tape 9
    (<em>Clauses additionnelles</em> ‚Üí <strong>R√©mun√©ration variable</strong>).
  </div>

    <div class="divider"></div>

  <!-- 13e mois (facultatif) ‚Äî alimente le calcul des minima -->

    <h4 class="mb-4">
      Prime de 13·µâ mois
      <span class="help" title="En choisissant cet option, le 13·µâ mois sera automatiquement pris en compte dans le calcul du salaire annuel.">i</span>
    </h4>

  <div class="fieldset" style="margin-top:14px">
    <label class="inline">
      <input type="checkbox" id="has_13th_month" name="has_13th_month" value="true">
      <span>Prendre en compte la pime de 13·µâ mois</span>
    </label>

    <div id="bonus13_fields" class="callout-muted" style="display:none; margin-top:8px">
      <div class="grid2">
        <div>
          <label for="bonus13_when">Date de versement</label>
          <select id="bonus13_when" name="bonus13_when">
            <option value="" selected disabled>Choisir‚Ä¶</option>
            <option value="50-50">50% en juin et 50% en d√©cembre</option>
            <option value="decembre">Avec le salaire de d√©cembre</option>
            <option value="janvier">Avec le salaire de janvier</option>
            <option value="autre">Autre</option>
          </select>
        </div>
        <div id="bonus13_when_free_wrap" style="display:none">
          <label for="bonus13_when_free">Pr√©cisez quand la prime de 13·µâ mois est vers√©e et dans quelle proportion</label>
          <input id="bonus13_when_free" name="bonus13_when_free" placeholder="Ex. en totalit√© en d√©cembre">
        </div>
      </div>

      <div class="grid2" style="margin-top:8px">
        <div>
          <label for="bonus13_base">Base de calcul</label>
          <select id="bonus13_base" name="bonus13_base">
            <option value="" selected disabled>Choisir‚Ä¶</option>
            <option value="janvier">Salaire fixe de janvier</option>
            <option value="decembre">Salaire fixe de d√©cembre</option>
            <option value="moyenne12">Moyenne des 12 derniers mois</option>
            <option value="mois_le_plus_eleve">Mois le plus √©lev√© de l‚Äôann√©e civile</option>
            <option value="autre">Autre</option>
          </select>
        </div>
        <div id="bonus13_base_free_wrap" style="display:none">
          <label for="bonus13_base_free">Pr√©cisez la base de calcul de la prime de 13·µâ mois</label>
          <input id="bonus13_base_free" name="bonus13_base_free" placeholder="Ex. moyenne des 6 premiers mois de l‚Äôann√©e">
        </div>
      </div>
    </div>
  </div>
  
  {# ===== Prime de pr√©carit√© (CDD) ===== #}
  {% if doc_type == 'cdd' %}
  <div class="divider"></div>
  <h4 class="mb-4">Prime de pr√©carit√© (indemnit√© de fin de contrat)</h4>
  <div class="callout-muted">
    <p class="small" style="margin:0">
      Taux par d√©faut: 10% (Code du travail). Certaines conventions collectives √©tendues peuvent pr√©voir 6% en contrepartie de garanties de formation. 
      Les √©v√©nements d‚Äôexclusion (poursuite en CDI, refus CDI √©quivalent, certaines ruptures anticip√©es, emplois saisonniers, etc.) sont rappel√©s dans le contrat et s‚Äôappr√©cient √† l‚Äôissue du CDD.
    </p>
  </div>
  <div class="grid3" style="margin-top:8px">
    <div>
      <label for="precarity_rate_percent">Taux applicable</label>
      <div class="input-with-suffix">
        <input id="precarity_rate_percent" name="precarity_rate_percent" type="number" step="0.1" min="0" max="20" placeholder="10">
        <span class="suffix">%</span>
      </div>
    </div>
    <div>
      <label for="precarity_rate_source">Source</label>
      <select id="precarity_rate_source" name="precarity_rate_source">
        <option value="" selected>Code du travail (10%)</option>
        <option value="accord_etendu">Accord de branche √©tendu (ex. 6%)</option>
        <option value="accord_entreprise">Accord d‚Äôentreprise</option>
        <option value="autre">Autre</option>
      </select>
    </div>
    <div>
      <label for="precarity_notes">Notes (optionnel)</label>
      <input id="precarity_notes" name="precarity_notes" placeholder="R√©f√©rence conventionnelle / pr√©cision utile">
    </div>
  </div>
  <div id="precarity_card" class="callout" style="display:none; margin-top:8px"></div>
  {% endif %}
  
    <div class="divider"></div>

<!-- P√©dagogie : minima conventionnels -->
<details id="salary_more_minima"class="callout callout-ccn zoom-card" style="display:block" mt-24>
  <summary>En savoir plus sur le respect des minima conventionnels</summary>
  <div id="salary_more_minima_body"
       data-slot="step6.more.minima"
  </div>
</details>

<!-- P√©dagogie : primes CCN -->
<details id="salary_more_primes" class="callout callout-ccn zoom-card" style="display:block" mt-24>
  <summary>Zoom sur les primes li√©es √† la convention collective</summary>
  <div id="salary_more_primes_body"
       data-slot="step6.more.ccn_primes"
  </div>
</details>

    <div class="divider"></div>

  <div class="actions" style="margin-top:12px">
    <button class="btn" data-prev>Pr√©c√©dent</button>
    <button class="btn-primary" data-next>Suivant</button>
  </div>
</div>
